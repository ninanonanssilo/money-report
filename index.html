<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Money Report</title>
    <meta name="description" content="견적서(엑셀/PDF)로 품의서를 자동 작성합니다." />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600&family=Spectral:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="style.css" />
    <script src="main.js" type="module" defer></script>
  </head>
  <body>
    <div class="bg" aria-hidden="true"></div>

    <header class="top">
      <div class="brand">
        <div class="mark" aria-hidden="true"></div>
        <div class="brand-text">
          <div class="name">Money Report</div>
          <div class="tag">견적서 첨부로 품의서 자동 작성</div>
        </div>
      </div>
      <div class="top-actions">
        <button id="btn-print" class="btn btn-ghost" type="button">인쇄</button>
      </div>
    </header>

    <main class="layout">
      <section class="card">
        <h1 class="h1">품의서 자동 작성</h1>
        <p class="lead">
          엑셀(.xlsx) 또는 PDF 견적서를 올리면, 항목/금액을 최대한 추출하고 공문서 스타일의 품의 문서를 생성합니다.
          (MVP: PDF는 형식에 따라 추출 품질이 달라질 수 있어요)
        </p>

        <div class="grid2">
          <div class="field">
            <label class="label" for="file">견적서 파일</label>
            <input id="file" class="input" type="file" accept=".xlsx,.pdf,application/pdf" />
            <div id="file-hint" class="hint">지원: .xlsx, .pdf</div>
          </div>

          <div class="field">
            <div class="label">OpenAI 연결</div>
            <div class="hint">Cloudflare Pages 환경변수 `OPENAI_API_KEY`로 설정해서 사용합니다. (브라우저 입력 없음)</div>
          </div>
        </div>

        <div class="divider"></div>

        <h2 class="h2">품의 정보</h2>
        <div class="grid2">
          <div class="field">
            <label class="label" for="subject">제목</label>
            <input id="subject" class="input" type="text" placeholder="예: 소프트웨어 구독 결제 품의" />
          </div>
          <div class="field">
            <label class="label" for="department">부서</label>
            <input id="department" class="input" type="text" placeholder="예: 개발팀" />
          </div>
          <div class="field">
            <label class="label" for="requester">기안자</label>
            <input id="requester" class="input" type="text" placeholder="예: 홍길동" />
          </div>
          <div class="field">
            <label class="label" for="docDate">작성일</label>
            <input id="docDate" class="input" type="date" />
          </div>
          <div class="field">
            <label class="label" for="purpose">목적/배경</label>
            <textarea id="purpose" class="textarea" rows="4" placeholder="예: 프로젝트 운영을 위한 필수 라이선스 확보"></textarea>
          </div>
          <div class="field">
            <label class="label" for="notes">비고</label>
            <textarea id="notes" class="textarea" rows="4" placeholder="예: 검토 요청 사항, 결재 라인 안내 등"></textarea>
          </div>
        </div>

        <div class="divider"></div>

        <h2 class="h2">견적서 텍스트 (PDF 추출이 안 될 때)</h2>
        <p class="hint">PDF가 이미지/스캔이면 자동 추출이 어려울 수 있습니다. 이 경우 텍스트를 붙여넣으면 생성 품질이 좋아집니다.</p>
        <textarea id="quoteText" class="textarea mono" rows="6" placeholder="견적서 내용 텍스트를 여기에 붙여넣기"></textarea>

        <div class="actions">
          <button id="btn-extract" class="btn" type="button">파일에서 항목 추출</button>
          <button id="btn-generate" class="btn btn-primary" type="button">품의서 생성</button>
        </div>

        <div id="status" class="status" role="status" aria-live="polite"></div>

        <div class="divider"></div>

        <h2 class="h2">추출 결과</h2>
        <div id="extractSummary" class="summary"></div>
        <div class="table-wrap">
          <table class="table" aria-label="추출 항목">
            <thead>
              <tr>
                <th>품목</th>
                <th class="num">수량</th>
                <th class="num">단가</th>
                <th class="num">금액</th>
                <th>비고</th>
              </tr>
            </thead>
            <tbody id="itemsTbody"></tbody>
          </table>
        </div>
      </section>

      <aside class="card paper">
        <div class="paper-toolbar">
          <div class="paper-title">미리보기</div>
          <button id="btn-copy" class="btn btn-ghost" type="button">복사</button>
        </div>
        <article id="doc" class="doc" aria-label="품의서 미리보기">
          <div class="doc-empty">
            아직 문서가 없습니다. 왼쪽에서 추출/생성을 진행하세요.
          </div>
        </article>
      </aside>
    </main>

    <template id="docTemplate">
      <section class="doc-page">
        <header class="doc-head">
          <div class="doc-kind">품 의 서</div>
          <div class="doc-meta">
            <div><span class="k">작성일</span> <span data-bind="docDate"></span></div>
            <div><span class="k">부서</span> <span data-bind="department"></span></div>
            <div><span class="k">기안자</span> <span data-bind="requester"></span></div>
          </div>
        </header>

        <h3 class="doc-subject" data-bind="subject"></h3>

        <div class="doc-section">
          <div class="doc-h">1. 목적</div>
          <div class="doc-b" data-bind="purpose"></div>
        </div>

        <div class="doc-section">
          <div class="doc-h">2. 견적 내역</div>
          <table class="doc-table">
            <thead>
              <tr>
                <th>품목</th>
                <th class="num">수량</th>
                <th class="num">단가</th>
                <th class="num">금액</th>
                <th>비고</th>
              </tr>
            </thead>
            <tbody data-bind="items"></tbody>
            <tfoot>
              <tr>
                <td colspan="3" class="num strong">합계</td>
                <td class="num strong" data-bind="total"></td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>

        <div class="doc-section">
          <div class="doc-h">3. 결재 요청</div>
          <div class="doc-b" data-bind="approval"></div>
        </div>

        <div class="doc-section">
          <div class="doc-h">4. 비고</div>
          <div class="doc-b" data-bind="notes"></div>
        </div>

        <footer class="doc-foot">
          <div>위와 같이 품의하오니 검토 후 결재 부탁드립니다.</div>
        </footer>
      </section>
    </template>
  </body>
</html>
